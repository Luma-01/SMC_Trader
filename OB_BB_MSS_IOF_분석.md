# OB, BB, MSS, IOF ì§„í–‰ ê³¼ì • ë° ì½”ë“œ ë¶„ì„

## 1. OB (Order Block) ë¶„ì„ ğŸ“Š

### 1.1 ì§„í–‰ ê³¼ì •
```
1. ìº”ë“¤ íŒ¨í„´ ìŠ¤ìº” (i-2, i-1, i+1~i+3)
2. Displacement ê°ì§€
3. Body ì˜ì—­ ì¶”ì¶œ (ê¼¬ë¦¬ ì œì™¸)
4. ê²¹ì¹˜ëŠ” OB êµì§‘í•© ì²˜ë¦¬
5. ì¤‘ë³µ ì•Œë¦¼ ì°¨ë‹¨
```

### 1.2 í™•ì¸ ê·¼ê±°

#### Bullish OB ì¡°ê±´
```python
# í•˜ë½ í›„ ìƒìŠ¹ displacement
if (
    c1["low"] > c2["low"]                    # ì´ì „ ë´‰ ëŒ€ë¹„ ì €ì  í•˜ë½
    and c2["low"] < c_next["low"]           # ì´í›„ ë´‰ ì €ì  ìƒìŠ¹
    and c_next["close"] > c_next["open"]    # ìƒìŠ¹ ë§ˆê° (ì–‘ë´‰)
):
```

#### Bearish OB ì¡°ê±´
```python
# ìƒìŠ¹ í›„ í•˜ë½ displacement
if (
    c1["high"] < c2["high"]                  # ì´ì „ ë´‰ ëŒ€ë¹„ ê³ ì  ìƒìŠ¹
    and c2["high"] > c_next["high"]         # ì´í›„ ë´‰ ê³ ì  í•˜ë½
    and c_next["close"] < c_next["open"]    # í•˜ë½ ë§ˆê° (ìŒë´‰)
):
```

### 1.3 ì½”ë“œìƒ ë¬¸ì œì  âš ï¸

#### ë¬¸ì œ 1: Single Displacement ê°ì§€
```python
for j in range(1, MAX_DISPLACEMENT + 1):
    # ... ì¡°ê±´ í™•ì¸ ...
    if condition:
        ob_zones.append(...)
        break  # â† ì²« ë²ˆì§¸ displacementë§Œ ê°ì§€í•˜ê³  ì¤‘ë‹¨
```
**ë¬¸ì œ**: í•˜ë‚˜ì˜ OBì—ì„œ ì—¬ëŸ¬ displacementê°€ ê°€ëŠ¥í•œë° ì²« ë²ˆì§¸ë§Œ ê°ì§€

#### ë¬¸ì œ 2: êµì§‘í•© ì²˜ë¦¬ ì‹œ ì‹œê°„ ì •ë³´ ì†ì‹¤
```python
# refine_overlapsì—ì„œ êµì§‘í•© ìƒì„± ì‹œ
base = dict(ob)  # ì²« ë²ˆì§¸ OBì˜ ì‹œê°„ ì •ë³´ë§Œ ìœ ì§€
base.update({"low": low, "high": high})
```
**ë¬¸ì œ**: ê²¹ì¹˜ëŠ” OBë“¤ì˜ ì‹œê°„ ì •ë³´ê°€ ì†ì‹¤ë¨

---

## 2. BB (Breaker Block) ë¶„ì„ ğŸ”„

### 2.1 ì§„í–‰ ê³¼ì •
```
1. ê¸°ì¡´ OB ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ
2. ê° OBì˜ ë¬´íš¨í™” ì—¬ë¶€ í™•ì¸
3. ë¬´íš¨í™” í›„ 3ë´‰ ì´ë‚´ ë°˜ì „ ê°ì§€
4. ë°˜ì „ ìº”ë“¤ì„ ìƒˆë¡œìš´ BBë¡œ ìƒì„±
```

### 2.2 í™•ì¸ ê·¼ê±°

#### OB ë¬´íš¨í™” ì¡°ê±´
```python
# Bullish OB ë¬´íš¨í™”
if ob_type == "bullish" and row['low'] < ob_low:
    invalidated = True

# Bearish OB ë¬´íš¨í™”  
if ob_type == "bearish" and row['high'] > ob_high:
    invalidated = True
```

#### BB ìƒì„± ì¡°ê±´
```python
# ë¬´íš¨í™” í›„ max_rebound_candles(3) ì´ë‚´ ë°˜ì „
for j in range(invalid_index + 1, min(invalid_index + 1 + max_rebound_candles, len(df_after))):
    rebound = df_after.iloc[j]
    # ë°˜ì „ ìº”ë“¤ì´ ìƒˆë¡œìš´ BBê°€ ë¨
```

### 2.3 ì½”ë“œìƒ ë¬¸ì œì  âš ï¸

#### ë¬¸ì œ 1: ì²« ë²ˆì§¸ ë°˜ì „ë§Œ BBë¡œ ì¸ì‹
```python
if ob_type == "bullish":
    bb_zones.append(...)
    break  # â† ì²« ë²ˆì§¸ ë°˜ì „ ìº”ë“¤ë§Œ BBë¡œ ìƒì„±
```
**ë¬¸ì œ**: ì—¬ëŸ¬ ë°˜ì „ ìº”ë“¤ì´ ìˆì„ ìˆ˜ ìˆëŠ”ë° ì²« ë²ˆì§¸ë§Œ ì„ íƒ

#### ë¬¸ì œ 2: ë°˜ì „ ê°•ë„ ê²€ì¦ ì—†ìŒ
```python
# ë‹¨ìˆœíˆ ë¬´íš¨í™” í›„ ìº”ë“¤ì„ BBë¡œ ìƒì„±
bb_zones.append({
    "type": "bearish",
    "high": float(high),
    "low": float(low),
    "time": rebound['time']
})
```
**ë¬¸ì œ**: ë°˜ì „ì˜ ê°•ë„ë‚˜ ìœ íš¨ì„± ê²€ì¦ ì—†ì´ BB ìƒì„±

---

## 3. MSS (Market Structure Shift) ë¶„ì„ ğŸ“ˆ

### 3.1 ì§„í–‰ ê³¼ì •
```
1. Structure ê°ì§€ (BOS/CHoCH)
2. ë°©í–¥ë³„ ìµœê·¼ BOS ì°¾ê¸°
3. ATR ê¸°ë°˜ BOS í­ ê²€ì¦
4. MSS ì§ì „ ìŠ¤ìœ™ í¬ì¸íŠ¸ ê³„ì‚°
5. ì¬ì§„ì… ì œí•œ ì ìš©
```

### 3.2 í™•ì¸ ê·¼ê±°

#### Structure ê°ì§€ ì¡°ê±´
```python
# BOS (Break of Structure)
if df[hi].iloc[i] > df[hi].iloc[i-1] and df[lo].iloc[i] > df[lo].iloc[i-1]:
    stype = 'BOS_up'
elif df[lo].iloc[i] < df[lo].iloc[i-1] and df[hi].iloc[i] < df[hi].iloc[i-1]:
    stype = 'BOS_down'

# CHoCH (Change of Character)
elif df[lo].iloc[i] > df[lo].iloc[i-1] and df[hi].iloc[i-2] > df[hi].iloc[i-1]:
    stype = 'CHoCH_up'
elif df[hi].iloc[i] < df[hi].iloc[i-1] and df[lo].iloc[i-2] < df[lo].iloc[i-1]:
    stype = 'CHoCH_down'
```

#### ATR í•„í„°ë§
```python
# BOS í­ì´ 0.8 Ã— ATR14 ì´ìƒì¼ ë•Œë§Œ MSS ì¸ì •
if bos_range < 0.8 * atr_val:
    return None
```

### 3.3 ì½”ë“œìƒ ë¬¸ì œì  âš ï¸

#### ë¬¸ì œ 1: ë„ˆë¬´ ì—„ê²©í•œ ATR í•„í„°ë§
```python
if bos_range < 0.8 * atr_val:
    return None
```
**ë¬¸ì œ**: 0.8 Ã— ATR ì¡°ê±´ì´ ë„ˆë¬´ ì—„ê²©í•´ì„œ ìœ íš¨í•œ MSSë¥¼ ë†“ì¹  ìˆ˜ ìˆìŒ

#### ë¬¸ì œ 2: ì¬ì§„ì… ì œí•œ í‚¤ ì •ê·œí™” ì´ìŠˆ
```python
key = (symbol, round(protective, 8))  # float í‚¤ ì •ê·œí™”
```
**ë¬¸ì œ**: ë¯¸ì„¸í•œ ê°€ê²© ì°¨ì´ë¡œ ì¸í•œ ì¬ì§„ì… ì œí•œ ìš°íšŒ ê°€ëŠ¥

---

## 4. IOF (Inducement, Order Flow) ë¶„ì„ ğŸŒŠ

### 4.1 ì§„í–‰ ê³¼ì •
```
1. HTF êµ¬ì¡° ë¶„ì„ â†’ Bias ê²°ì •
2. í˜„ì¬ ê°€ê²©ê³¼ HTF ì¡´ì˜ ê´€ê³„ í™•ì¸
3. ENTRY_METHODì— ë”°ë¥¸ ë¶„ê¸°
4. LTF êµ¬ì¡° ì»¨íŒ (zone_and_mss ëª¨ë“œ)
5. ìµœì¢… ì§„ì… ì‹ í˜¸ ìƒì„±
```

### 4.2 í™•ì¸ ê·¼ê±°

#### HTF Bias ê²°ì •
```python
if recent == 'BOS_up':
    bias = 'LONG'
elif recent == 'BOS_down':
    bias = 'SHORT'
elif recent.startswith('CHoCH'):
    bias = 'NONE'
```

#### ì¡´ ì§„ì… í™•ì¸
```python
def _in_zone(z):
    low  = Decimal(str(z['low'])).quantize(tick_size)
    high = Decimal(str(z['high'])).quantize(tick_size)
    return (low - buffer) <= current_price <= (high + buffer)
```

#### LTF êµ¬ì¡° ì»¨íŒ
```python
need_long  = last_struct in ('BOS_up', 'CHoCH_up')
need_short = last_struct in ('BOS_down', 'CHoCH_down')
```

### 4.3 ì½”ë“œìƒ ë¬¸ì œì  âš ï¸

#### ë¬¸ì œ 1: ê³ ì • ë²„í¼ ì‚¬ìš©
```python
buffer = tick_size * 10  # ê³ ì • ë²„í¼
```
**ë¬¸ì œ**: ë³€ë™ì„±ì— ê´€ê³„ì—†ì´ ê³ ì • ë²„í¼ ì‚¬ìš©ìœ¼ë¡œ ë¶€ì •í™•í•œ ì¡´ ì§„ì… íŒë‹¨

#### ë¬¸ì œ 2: OB Break êµ¬ì¡° ëˆ„ë½
```python
# structure.pyì—ì„œ OB_Break_up/down ê°ì§€í•˜ì§€ë§Œ
# IOFì—ì„œëŠ” BOS/CHoCHë§Œ í™•ì¸
need_long  = last_struct in ('BOS_up', 'CHoCH_up')
need_short = last_struct in ('BOS_down', 'CHoCH_down')
```
**ë¬¸ì œ**: OB_Break êµ¬ì¡°ê°€ ì§„ì… ì¡°ê±´ì—ì„œ ëˆ„ë½ë¨

---

## 5. ì „ì²´ íë¦„ë„ ë° ìƒí˜¸ì‘ìš©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTF ë¶„ì„   â”‚â”€â”€â”€â”€â”‚  IOF íŒë‹¨   â”‚â”€â”€â”€â”€â”‚  LTF ì»¨íŒ   â”‚
â”‚ - Structure â”‚    â”‚ - OB/BB ì¡´  â”‚    â”‚ - MSS í™•ì¸  â”‚
â”‚ - Bias      â”‚    â”‚ - ì¡´ ì§„ì…   â”‚    â”‚ - ë¦¬ì ì…˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OB ê°ì§€     â”‚    â”‚ BB ê°ì§€     â”‚    â”‚ MSS ê°ì§€    â”‚
â”‚ - 3ë´‰ íŒ¨í„´  â”‚    â”‚ - OB ë¬´íš¨í™” â”‚    â”‚ - ATR í•„í„°  â”‚
â”‚ - Body ì˜ì—­ â”‚    â”‚ - 3ë´‰ ë°˜ì „  â”‚    â”‚ - ë³´í˜¸ì„     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ê¶Œì¥ ê°œì„ ì‚¬í•­ ğŸ”§

### 6.1 OB ê°œì„ 
1. **Multiple Displacement ê°ì§€**: break ì œê±°í•˜ì—¬ ëª¨ë“  displacement ê°ì§€
2. **ì‹œê°„ ì •ë³´ ë³´ì¡´**: êµì§‘í•© ì²˜ë¦¬ ì‹œ ì‹œê°„ ë²”ìœ„ ì •ë³´ ìœ ì§€
3. **ê°•ë„ ê²€ì¦**: displacement ê°•ë„ì— ë”°ë¥¸ OB í’ˆì§ˆ í‰ê°€

### 6.2 BB ê°œì„ 
1. **Multiple Rebound ê°ì§€**: ì²« ë²ˆì§¸ ë°˜ì „ë¿ë§Œ ì•„ë‹ˆë¼ ì—°ì† ë°˜ì „ ê°ì§€
2. **ë°˜ì „ ê°•ë„ ê²€ì¦**: ë°˜ì „ì˜ ìœ íš¨ì„± í™•ì¸ (ê±°ë˜ëŸ‰, ìº”ë“¤ í¬ê¸° ë“±)
3. **ì‹œê°„ ì œí•œ ì™„í™”**: 3ë´‰ ì œí•œì„ ë™ì ìœ¼ë¡œ ì¡°ì •

### 6.3 MSS ê°œì„ 
1. **ATR í•„í„° ì™„í™”**: 0.8 â†’ 0.6 ë˜ëŠ” ë™ì  ì¡°ì •
2. **ì¬ì§„ì… í‚¤ ê°œì„ **: ê°€ê²© ë²”ìœ„ ê¸°ë°˜ í‚¤ ì‚¬ìš©
3. **ë³´í˜¸ì„  ì •ë°€ë„**: ë” ì •í™•í•œ ìŠ¤ìœ™ í¬ì¸íŠ¸ ê³„ì‚°

### 6.4 IOF ê°œì„ 
1. **ë™ì  ë²„í¼**: ATR ê¸°ë°˜ ë²„í¼ ê³„ì‚°
2. **OB Break í¬í•¨**: ëª¨ë“  êµ¬ì¡° ìœ í˜• ì§„ì… ì¡°ê±´ í¬í•¨
3. **ì¡´ í’ˆì§ˆ í‰ê°€**: ì¡´ì˜ ì‹ ë¢°ë„ì— ë”°ë¥¸ ê°€ì¤‘ì¹˜ ì ìš©

---

## 7. ê²°ë¡  ë° ìš°ì„ ìˆœìœ„

### 7.1 ê¸´ê¸‰ ìˆ˜ì • í•„ìš” ğŸš¨
1. **IOF ë™ì  ë²„í¼**: ê³ ì • ë²„í¼ â†’ ATR ê¸°ë°˜ ë²„í¼
2. **OB Break í¬í•¨**: LTF êµ¬ì¡° ì»¨íŒì— OB_Break ì¶”ê°€
3. **MSS ATR í•„í„° ì™„í™”**: 0.8 â†’ 0.6ìœ¼ë¡œ ì¡°ì •

### 7.2 ì¤‘ê¸° ê°œì„  ğŸ“‹
1. **Multiple Displacement**: OB ê°ì§€ ë¡œì§ ê°œì„ 
2. **BB ë°˜ì „ ê°•ë„**: ë°˜ì „ ìœ íš¨ì„± ê²€ì¦ ì¶”ê°€
3. **ì¬ì§„ì… í‚¤ ê°œì„ **: ê°€ê²© ë²”ìœ„ ê¸°ë°˜ í‚¤ ì‚¬ìš©

### 7.3 ì¥ê¸° ìµœì í™” ğŸ¯
1. **ML ê¸°ë°˜ ì¡´ í’ˆì§ˆ**: ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ ì¡´ ì‹ ë¢°ë„ í‰ê°€
2. **ë™ì  íŒŒë¼ë¯¸í„°**: ì‹œì¥ ìƒí™©ì— ë”°ë¥¸ íŒŒë¼ë¯¸í„° ìë™ ì¡°ì •
3. **ë°±í…ŒìŠ¤íŒ… ìµœì í™”**: íˆìŠ¤í† ë¦¬ì»¬ ë°ì´í„° ê¸°ë°˜ íŒŒë¼ë¯¸í„° íŠœë‹

---

## 8. ì½”ë“œ ì•ˆì •ì„± í‰ê°€ â­

| ì»´í¬ë„ŒíŠ¸ | ì•ˆì •ì„± | ì •í™•ì„± | íš¨ìœ¨ì„± | ì¢…í•© ì ìˆ˜ |
|----------|--------|--------|--------|-----------|
| OB       | â­â­â­â­ | â­â­â­   | â­â­â­â­ | 3.5/5     |
| BB       | â­â­â­   | â­â­â­   | â­â­â­â­ | 3.0/5     |
| MSS      | â­â­â­   | â­â­     | â­â­â­   | 2.5/5     |
| IOF      | â­â­â­â­ | â­â­     | â­â­â­   | 3.0/5     |

**ì „ì²´ í‰ê°€**: í˜„ì¬ ì‹œìŠ¤í…œì€ ê¸°ë³¸ì ì¸ ê¸°ëŠ¥ì€ ì•ˆì •ì ì´ë‚˜, ì •í™•ì„±ê³¼ íš¨ìœ¨ì„± ë©´ì—ì„œ ê°œì„ ì˜ ì—¬ì§€ê°€ ìˆìŒ